<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>NZUBO ¬∑ iOS purple white</title>
  <!-- Font Awesome (icons) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Cloudinary upload widget -->
  <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
  <!-- Firebase SDK (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    }

    body {
      min-height: 100vh;
      background: #ffffff; /* pure white background */
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    /* floating card ‚Äì white, purple border, soft shadows */
    .ios-card {
      background: #ffffff;
      width: 100%;
      max-width: 520px;
      border-radius: 32px;
      border: 2px solid #b47aff; /* thin purple border */
      box-shadow: 0 25px 50px -10px rgba(128, 0, 255, 0.2), 0 0 0 1px rgba(180, 122, 255, 0.3);
      padding: 2.2rem 2rem;
      backdrop-filter: blur(2px);
      transition: all 0.2s ease;
    }

    /* header with big purple NZUBO + home icon */
    .brand-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.6rem;
      margin-bottom: 2rem;
    }
    .brand-header h1 {
      font-size: 4rem;
      font-weight: 800;
      letter-spacing: -1px;
      color: #8a4fff; /* vibrant purple */
      text-shadow: 0 3px 12px rgba(138, 79, 255, 0.25);
      line-height: 1;
    }
    .brand-header i {
      font-size: 3rem;
      color: #8a4fff;
      filter: drop-shadow(0 3px 8px rgba(138, 79, 255, 0.3));
    }

    /* login form */
    .login-form {
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
      margin-bottom: 2.2rem;
    }
    .input-field {
      position: relative;
      width: 100%;
    }
    .input-field i {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: #a07aff;
      font-size: 1.2rem;
    }
    .input-field input {
      width: 100%;
      padding: 1rem 1rem 1rem 3rem;
      border: 1.8px solid #e6d9ff;
      border-radius: 24px;
      font-size: 1rem;
      background: white;
      box-shadow: 0 8px 18px -6px rgba(128, 0, 255, 0.1);
      transition: all 0.2s;
    }
    .input-field input:focus {
      outline: none;
      border-color: #b47aff;
      box-shadow: 0 8px 22px -4px #b47aff55;
    }
    .btn-login {
      background: #8a4fff;
      border: none;
      border-radius: 30px;
      padding: 1rem;
      color: white;
      font-weight: 700;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.6rem;
      cursor: pointer;
      box-shadow: 0 15px 25px -8px #b47aff;
      transition: all 0.15s;
      border: 1px solid #b47aff;
    }
    .btn-login:hover {
      background: #753fe8;
      transform: scale(1.01);
    }

    /* floating register icons */
    .register-floating-row {
      display: flex;
      align-items: center;
      justify-content: space-around;
      margin: 2rem 0 0.5rem;
    }
    .reg-icon {
      background: white;
      border: 2px solid #b47aff;
      border-radius: 50%;
      width: 80px;
      height: 80px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      box-shadow: 0 16px 30px -12px rgba(128, 0, 255, 0.4);
      transition: 0.15s;
      cursor: pointer;
      color: #5f2eb0;
      font-size: 0.9rem;
      font-weight: 600;
      gap: 0.2rem;
    }
    .reg-icon i {
      font-size: 2.2rem;
      color: #8a4fff;
    }
    .reg-icon:hover {
      transform: translateY(-5px);
      background: #f7f2ff;
      border-color: #9a5eff;
    }

    /* modal overlay (hidden by default) */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.2);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      visibility: hidden;
      opacity: 0;
      transition: 0.2s;
    }
    .modal-overlay.show {
      visibility: visible;
      opacity: 1;
    }
    .modal-card {
      background: white;
      max-width: 480px;
      width: 90%;
      border-radius: 36px;
      border: 2px solid #b47aff;
      padding: 2rem 1.8rem;
      box-shadow: 0 40px 70px -10px #9a5eff;
      max-height: 85vh;
      overflow-y: auto;
    }
    .modal-card h3 {
      font-size: 2rem;
      color: #5f2eb0;
      margin-bottom: 1.5rem;
      display: flex;
      gap: 0.5rem;
    }

    /* form inside modal */
    .reg-form {
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
    }
    .reg-form input, .reg-form select {
      padding: 0.9rem 1rem;
      border: 1.8px solid #e6d9ff;
      border-radius: 30px;
      font-size: 1rem;
      background: white;
    }
    .reg-form input:focus {
      border-color: #b47aff;
      outline: none;
    }
    /* profile upload area (reused from sample) */
    .profile-upload-section {
      margin: 0.5rem 0;
    }
    .upload-label {
      font-weight: 600;
      color: #5f2eb0;
      margin-bottom: 0.5rem;
      display: block;
    }
    .profile-upload-container {
      display: flex;
      align-items: center;
      gap: 1.2rem;
      flex-wrap: wrap;
    }
    .upload-preview {
      width: 85px;
      height: 85px;
      border-radius: 50%;
      background: #f3edff;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      border: 2px dashed #b47aff;
    }
    .preview-placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #b29aff;
      font-size: 0.8rem;
    }
    .preview-placeholder i {
      font-size: 2.2rem;
    }
    .upload-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .upload-buttons {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .btn-upload, .btn-remove {
      background: white;
      border: 1.8px solid #b47aff;
      border-radius: 40px;
      padding: 0.6rem 1.2rem;
      font-weight: 600;
      color: #6f3bdb;
      cursor: pointer;
      transition: 0.1s;
    }
    .btn-remove {
      border-color: #ff6b8b;
      color: #d94a6a;
    }
    .hidden {
      display: none !important;
    }
    .city-select {
      background: white;
    }
    .btn-submit {
      background: #8a4fff;
      border: none;
      border-radius: 40px;
      padding: 1rem;
      color: white;
      font-weight: 700;
      font-size: 1.2rem;
      margin-top: 0.8rem;
      cursor: pointer;
    }
    .toast-container {
      position: fixed;
      top: 20px; right: 20px;
      z-index: 9999;
    }
    .toast {
      background: #1f1f2e;
      color: white;
      padding: 1rem 1.8rem;
      border-radius: 60px;
      margin-bottom: 0.5rem;
      box-shadow: 0 15px 30px #b47aff40;
      border-left: 6px solid #b47aff;
      font-weight: 500;
    }
  </style>
</head>
<body>
  <div class="ios-card">
    <!-- big purple NZUBO + home icon -->
    <div class="brand-header">
      <i class="fas fa-home"></i>
      <h1>NZUBO</h1>
    </div>

    <!-- login form (email + password) -->
    <div class="login-form">
      <div class="input-field">
        <i class="fas fa-envelope"></i>
        <input type="email" id="loginEmail" placeholder="Email" value="">
      </div>
      <div class="input-field">
        <i class="fas fa-lock"></i>
        <input type="password" id="loginPassword" placeholder="Password">
      </div>
      <button class="btn-login" id="loginBtn"><i class="fas fa-sign-in-alt"></i> Sign in</button>
    </div>

    <!-- three floating icons for register -->
    <div class="register-floating-row">
      <div class="reg-icon" id="showLandlordReg">
        <i class="fas fa-user-tie"></i>
        <span>landlord</span>
      </div>
      <div class="reg-icon" id="showTenantReg">
        <i class="fas fa-user"></i>
        <span>tenant</span>
      </div>
      <div class="reg-icon" id="showAgentReg">
        <i class="fas fa-user-headset"></i>
        <span>agent</span>
      </div>
    </div>
    <p style="text-align: center; color: #a07aff; font-size: 0.9rem; margin-top: 0.5rem;">register as</p>
  </div>

  <!-- MODALS for each registration type -->

  <!-- LANDLORD registration modal -->
  <div class="modal-overlay" id="landlordModal">
    <div class="modal-card">
      <h3><i class="fas fa-user-tie"></i> Landlord signup</h3>
      <div class="reg-form" id="landlordForm">
        <!-- profile pic -->
        <div class="profile-upload-section" id="landlordUploadSection">
          <label class="upload-label">Profile picture</label>
          <div class="profile-upload-container">
            <div class="upload-preview" id="landlordPreview">
              <div class="preview-placeholder" id="landlordPlaceholder">
                <i class="fas fa-user-circle"></i><span>add</span>
              </div>
              <img id="landlordImg" class="hidden" style="width:100%; height:100%">
            </div>
            <div class="upload-buttons">
              <button class="btn-upload" type="button" onclick="openCloudinaryUploader('landlord')"><i class="fas fa-cloud-upload-alt"></i> Upload</button>
              <button class="btn-remove" type="button" onclick="removeProfileImage('landlord')"><i class="fas fa-trash"></i> Remove</button>
            </div>
          </div>
        </div>
        <input type="text" id="landlordName" placeholder="Full name" required>
        <input type="tel" id="landlordPhone" placeholder="Phone number" required>
        <!-- city dropdown (Zambia) with search -->
        <select id="landlordCity" class="city-select" required>
          <option value="" disabled selected>üèôÔ∏è City in Zambia</option>
        </select>
        <!-- no email field ‚Äì generated later -->
        <button type="button" class="btn-submit" onclick="registerLandlord()">Create landlord account</button>
      </div>
    </div>
  </div>

  <!-- TENANT registration modal -->
  <div class="modal-overlay" id="tenantModal">
    <div class="modal-card">
      <h3><i class="fas fa-user"></i> Tenant signup</h3>
      <div class="reg-form" id="tenantForm">
        <div class="profile-upload-section" id="tenantUploadSection">
          <label class="upload-label">Profile picture</label>
          <div class="profile-upload-container">
            <div class="upload-preview" id="tenantPreview">
              <div class="preview-placeholder" id="tenantPlaceholder"><i class="fas fa-user-circle"></i><span>add</span></div>
              <img id="tenantImg" class="hidden">
            </div>
            <div class="upload-buttons">
              <button class="btn-upload" type="button" onclick="openCloudinaryUploader('tenant')"><i class="fas fa-cloud-upload-alt"></i> Upload</button>
              <button class="btn-remove" type="button" onclick="removeProfileImage('tenant')"><i class="fas fa-trash"></i> Remove</button>
            </div>
          </div>
        </div>
        <input type="text" id="tenantName" placeholder="Full name" required>
        <input type="email" id="tenantEmail" placeholder="Email (must be @gmail.com)" required>
        <input type="tel" id="tenantPhone" placeholder="Phone number" required>
        <input type="password" id="tenantPassword" placeholder="Password" required>
        <button type="button" class="btn-submit" onclick="registerTenant()">Create tenant account</button>
      </div>
    </div>
  </div>

  <!-- AGENT registration modal -->
  <div class="modal-overlay" id="agentModal">
    <div class="modal-card">
      <h3><i class="fas fa-user-headset"></i> Agent signup</h3>
      <div class="reg-form" id="agentForm">
        <div class="profile-upload-section" id="agentUploadSection">
          <label class="upload-label">Profile picture</label>
          <div class="profile-upload-container">
            <div class="upload-preview" id="agentPreview">
              <div class="preview-placeholder" id="agentPlaceholder"><i class="fas fa-user-circle"></i><span>add</span></div>
              <img id="agentImg" class="hidden">
            </div>
            <div class="upload-buttons">
              <button class="btn-upload" type="button" onclick="openCloudinaryUploader('agent')"><i class="fas fa-cloud-upload-alt"></i> Upload</button>
              <button class="btn-remove" type="button" onclick="removeProfileImage('agent')"><i class="fas fa-trash"></i> Remove</button>
            </div>
          </div>
        </div>
        <input type="text" id="agentName" placeholder="Full name" required>
        <input type="tel" id="agentPhone" placeholder="Phone number" required>
        <select id="agentCity" class="city-select" required>
          <option value="" disabled selected>üèôÔ∏è City in Zambia</option>
        </select>
        <button type="button" class="btn-submit" onclick="registerAgent()">Create agent account</button>
      </div>
    </div>
  </div>

  <!-- popup credentials modal (for agent/landlord) -->
  <div class="modal-overlay" id="credentialModal">
    <div class="modal-card" style="text-align: center;">
      <i class="fas fa-envelope-open-text" style="font-size: 3rem; color:#8a4fff;"></i>
      <h3 style="color:#4a2b7a;">Account created</h3>
      <p id="credMessage" style="margin: 1rem 0; background: #efeaff; padding: 1rem; border-radius: 24px;"></p>
      <button class="btn-submit" style="background:#4a2b7a;" onclick="closeCredentialModal()">OK</button>
    </div>
  </div>

  <!-- toast container -->
  <div class="toast-container" id="toastContainer"></div>

  <script>
    // ---------- FIREBASE INIT (new config) ----------
    const firebaseConfig = {
      apiKey: "AIzaSyCzf9dZFB0l7ZEPLJ4tpo4bSjgQNW3VTus",
      authDomain: "dmkl-8ea2c.firebaseapp.com",
      databaseURL: "https://dmkl-8ea2c-default-rtdb.firebaseio.com",
      projectId: "dmkl-8ea2c",
      storageBucket: "dmkl-8ea2c.firebasestorage.app",
      messagingSenderId: "155892504799",
      appId: "1:155892504799:web:45ed0037fd0fe79b85b16a",
      measurementId: "G-61M65C4MZ2"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();

    // ---------- Cloudinary config (from sample) ----------
    const CLOUDINARY_CONFIG = {
      cloudName: 'dd3lcymrk',
      uploadPreset: 'h3eyhc2o',
      folder: 'zynapse/profiles'
    };

    // ---------- Global vars for profile images ----------
      // store per role
    let landlordImageUrl = '';
    let tenantImageUrl = '';
    let agentImageUrl = '';

    // ---------- Zambia cities (sample) ----------
    const zambiaCities = [
      'Lusaka', 'Ndola', 'Kitwe', 'Kabwe', 'Chingola', 'Mufulira', 'Livingstone', 'Kasama', 'Chipata', 'Solwezi',
      'Mongu', 'Mansa', 'Mazabuka', 'Kafue', 'Luanshya', 'Kalulushi', 'Choma', 'Mpika', 'Siavonga', 'Kapiri Mposhi'
    ];

    function populateCityDropdowns() {
      const selects = document.querySelectorAll('.city-select');
      selects.forEach(select => {
        select.innerHTML = '<option value="" disabled selected>üèôÔ∏è City in Zambia</option>';
        zambiaCities.forEach(city => {
          const opt = document.createElement('option');
          opt.value = city;
          opt.textContent = city;
          select.appendChild(opt);
        });
      });
    }
    populateCityDropdowns();

    // ---------- Toast ----------
    function showToast(msg, type = 'info') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = `<i class="fas fa-${type==='success'?'check-circle':'info-circle'}"></i> ${msg}`;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 4000);
    }

    // ---------- Modal controls ----------
    const modals = {
      landlord: document.getElementById('landlordModal'),
      tenant: document.getElementById('tenantModal'),
      agent: document.getElementById('agentModal')
    };
    document.getElementById('showLandlordReg').addEventListener('click', ()=> modals.landlord.classList.add('show'));
    document.getElementById('showTenantReg').addEventListener('click', ()=> modals.tenant.classList.add('show'));
    document.getElementById('showAgentReg').addEventListener('click', ()=> modals.agent.classList.add('show'));

    // close modals when clicking overlay background
    Object.values(modals).forEach(m => m.addEventListener('click', (e) => { if(e.target === m) m.classList.remove('show'); }));

    // ---------- Cloudinary upload (reusable per role) ----------
    let activeRole = null;
    function openCloudinaryUploader(role) {
      activeRole = role;
      if (!window.cloudinaryWidget) {
        window.cloudinaryWidget = cloudinary.createUploadWidget({
          cloudName: CLOUDINARY_CONFIG.cloudName,
          uploadPreset: CLOUDINARY_CONFIG.uploadPreset,
          sources: ['local', 'camera'],
          multiple: false,
          cropping: true,
          croppingAspectRatio: 1,
          folder: CLOUDINARY_CONFIG.folder,
        }, (error, result) => {
          if (!error && result && result.event === "success") {
            const url = result.info.secure_url;
            if (activeRole === 'landlord') {
              landlordImageUrl = url;
              document.getElementById('landlordImg').src = url;
              document.getElementById('landlordImg').classList.remove('hidden');
              document.getElementById('landlordPlaceholder').classList.add('hidden');
            } else if (activeRole === 'tenant') {
              tenantImageUrl = url;
              document.getElementById('tenantImg').src = url;
              document.getElementById('tenantImg').classList.remove('hidden');
              document.getElementById('tenantPlaceholder').classList.add('hidden');
            } else if (activeRole === 'agent') {
              agentImageUrl = url;
              document.getElementById('agentImg').src = url;
              document.getElementById('agentImg').classList.remove('hidden');
              document.getElementById('agentPlaceholder').classList.add('hidden');
            }
            showToast('Image uploaded!', 'success');
          } else if (error) {
            showToast('Upload error', 'error');
          }
        });
      }
      window.cloudinaryWidget.open();
    }

    function removeProfileImage(role) {
      if (role === 'landlord') {
        landlordImageUrl = '';
        document.getElementById('landlordImg').classList.add('hidden');
        document.getElementById('landlordPlaceholder').classList.remove('hidden');
      } else if (role === 'tenant') {
        tenantImageUrl = '';
        document.getElementById('tenantImg').classList.add('hidden');
        document.getElementById('tenantPlaceholder').classList.remove('hidden');
      } else if (role === 'agent') {
        agentImageUrl = '';
        document.getElementById('agentImg').classList.add('hidden');
        document.getElementById('agentPlaceholder').classList.remove('hidden');
      }
    }

    // ---------- Helper: random password ----------
    function randomPassword() {
      return Math.random().toString(36).slice(-8) + 'A1!';
    }

    // ---------- Register landlord (no email field, generate landlord@name.com) ----------
    async function registerLandlord() {
      const name = document.getElementById('landlordName').value.trim();
      const phone = document.getElementById('landlordPhone').value.trim();
      const city = document.getElementById('landlordCity').value;
      if (!name || !phone || !city || !landlordImageUrl) {
        showToast('Please fill all fields and upload a profile picture', 'error');
        return;
      }
      // generate email: landlord@(firstName?). use full name lower case, remove spaces
      const emailLocal = 'landlord@' + name.toLowerCase().replace(/\s+/g, '') + '.com';
      const password = randomPassword();

      try {
        const cred = await auth.createUserWithEmailAndPassword(emailLocal, password);
        const user = cred.user;
        // store in RTDB
        await database.ref('users/' + user.uid).set({
          role: 'landlord',
          fullName: name,
          phone: phone,
          city: city,
          profilePicture: landlordImageUrl,
          loginEmail: emailLocal,
          createdAt: new Date().toISOString()
        });
        // show popup with credentials
        document.getElementById('credMessage').innerText = `use email ${emailLocal} and password ${password} to log in.`;
        document.getElementById('credentialModal').classList.add('show');
        modals.landlord.classList.remove('show');
        // clear fields
        document.getElementById('landlordName').value = '';
        document.getElementById('landlordPhone').value = '';
        document.getElementById('landlordCity').value = '';
        removeProfileImage('landlord');
        landlordImageUrl = '';
      } catch (err) {
        showToast('Error: ' + err.message, 'error');
      }
    }

    // ---------- Register tenant (uses provided email, must be @gmail.com) ----------
    async function registerTenant() {
      const name = document.getElementById('tenantName').value.trim();
      const email = document.getElementById('tenantEmail').value.trim();
      const phone = document.getElementById('tenantPhone').value.trim();
      const password = document.getElementById('tenantPassword').value;
      if (!name || !email || !phone || !password || !tenantImageUrl) {
        showToast('All fields + profile picture required', 'error');
        return;
      }
      if (!email.toLowerCase().endsWith('@gmail.com')) {
        showToast('Tenant email must be @gmail.com', 'error');
        return;
      }
      try {
        const cred = await auth.createUserWithEmailAndPassword(email, password);
        const user = cred.user;
        await database.ref('users/' + user.uid).set({
          role: 'tenant',
          fullName: name,
          phone: phone,
          profilePicture: tenantImageUrl,
          email: email,
          createdAt: new Date().toISOString()
        });
        showToast('Tenant account created! You can now log in.', 'success');
        modals.tenant.classList.remove('show');
        document.getElementById('tenantName').value = '';
        document.getElementById('tenantEmail').value = '';
        document.getElementById('tenantPhone').value = '';
        document.getElementById('tenantPassword').value = '';
        removeProfileImage('tenant');
        tenantImageUrl = '';
      } catch (err) {
        showToast(err.message, 'error');
      }
    }

    // ---------- Register agent (similar to landlord) ----------
    async function registerAgent() {
      const name = document.getElementById('agentName').value.trim();
      const phone = document.getElementById('agentPhone').value.trim();
      const city = document.getElementById('agentCity').value;
      if (!name || !phone || !city || !agentImageUrl) {
        showToast('All fields + profile picture required', 'error');
        return;
      }
      const emailLocal = 'agent@' + name.toLowerCase().replace(/\s+/g, '') + '.com';
      const password = randomPassword();

      try {
        const cred = await auth.createUserWithEmailAndPassword(emailLocal, password);
        const user = cred.user;
        await database.ref('users/' + user.uid).set({
          role: 'agent',
          fullName: name,
          phone: phone,
          city: city,
          profilePicture: agentImageUrl,
          loginEmail: emailLocal,
          createdAt: new Date().toISOString()
        });
        document.getElementById('credMessage').innerText = `use email ${emailLocal} and password ${password} to log in.`;
        document.getElementById('credentialModal').classList.add('show');
        modals.agent.classList.remove('show');
        document.getElementById('agentName').value = '';
        document.getElementById('agentPhone').value = '';
        document.getElementById('agentCity').value = '';
        removeProfileImage('agent');
        agentImageUrl = '';
      } catch (err) {
        showToast(err.message, 'error');
      }
    }

    function closeCredentialModal() {
      document.getElementById('credentialModal').classList.remove('show');
    }

    // ---------- LOGIN & REDIRECT based on email pattern ----------
    document.getElementById('loginBtn').addEventListener('click', async (e) => {
      const email = document.getElementById('loginEmail').value.trim();
      const pass = document.getElementById('loginPassword').value.trim();
      if (!email || !pass) {
        showToast('Enter email and password', 'error');
        return;
      }
      try {
        const userCred = await auth.signInWithEmailAndPassword(email, pass);
        const user = userCred.user;
        // fetch role from db (optional, but we can rely on email pattern)
        // redirect based on email pattern:
        if (email.toLowerCase().endsWith('@gmail.com')) {
          window.location.href = 'tenant.html';
        } else if (email.toLowerCase().startsWith('landlord@')) {
          window.location.href = 'landlord.html';
        } else if (email.toLowerCase().startsWith('agent@')) {
          window.location.href = 'agent.html';
        } else {
          // fallback
          showToast('Logged in, but role unknown. Redirect to default.', 'info');
          window.location.href = 'home.html';
        }
      } catch (err) {
        showToast('Login failed: ' + err.message, 'error');
      }
    });

    // close credential modal also on background click
    document.getElementById('credentialModal').addEventListener('click', function(e) {
      if (e.target === this) closeCredentialModal();
    });

    // populate cities again if any new selects appear (none)
  </script>
</body>
</html>
